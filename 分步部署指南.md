# ðŸš€ åˆ†æ­¥éƒ¨ç½²æŒ‡å— - ç«‹å³å¼€å§‹

ç”±äºŽè‡ªåŠ¨åŒ–è„šæœ¬éœ€è¦ç‰¹æ®Šæƒé™ï¼Œè¿™é‡Œæä¾›**æœ€ç®€å•çš„æ‰‹åŠ¨åˆ†æ­¥æ“ä½œ**ã€‚

---

## âš¡ å¿«é€Ÿå¼€å§‹ï¼ˆå¤åˆ¶ç²˜è´´å³å¯ï¼‰

### æ­¥éª¤1: æ‰“å¼€PowerShell

1. æŒ‰ `Win + X`
2. é€‰æ‹© "Windows PowerShell (ç®¡ç†å‘˜)" æˆ– "ç»ˆç«¯ (ç®¡ç†å‘˜)"

### æ­¥éª¤2: è¿›å…¥é¡¹ç›®ç›®å½•

```powershell
cd D:\tecx\text\25\soraui_4.0\sora-ui-backend
```

### æ­¥éª¤3: æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆé€ä¸ªå¤åˆ¶æ‰§è¡Œï¼‰

---

## ðŸ“‹ å‘½ä»¤1: æ£€æŸ¥çŽ¯å¢ƒ

```powershell
# æ£€æŸ¥å¿…è¦æ–‡ä»¶
if (Test-Path "package.json") { 
    Write-Host "âœ… æ‰¾åˆ° package.json" -ForegroundColor Green 
} else { 
    Write-Host "âŒ æœªæ‰¾åˆ° package.json" -ForegroundColor Red 
}

if (Test-Path "Dockerfile") { 
    Write-Host "âœ… æ‰¾åˆ° Dockerfile" -ForegroundColor Green 
} else { 
    Write-Host "âŒ æœªæ‰¾åˆ° Dockerfile" -ForegroundColor Red 
}
```

---

## ðŸ“‹ å‘½ä»¤2: æµ‹è¯•æœåŠ¡å™¨è¿žæŽ¥

```powershell
$SERVER_IP = "175.27.250.155"
$SERVER_USER = "ubuntu"

Write-Host "ðŸ” æµ‹è¯•è¿žæŽ¥ $SERVER_IP ..." -ForegroundColor Yellow
ssh "${SERVER_USER}@${SERVER_IP}" "echo 'âœ… æœåŠ¡å™¨è¿žæŽ¥æˆåŠŸ'"
```

**å¦‚æžœè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š**
- SSHå¯†é’¥æ˜¯å¦é…ç½®
- æœåŠ¡å™¨IPæ˜¯å¦æ­£ç¡®
- å®‰å…¨ç»„22ç«¯å£æ˜¯å¦å¼€æ”¾

---

## ðŸ“‹ å‘½ä»¤3: å‡†å¤‡æœåŠ¡å™¨çŽ¯å¢ƒ

```powershell
$SERVER_IP = "175.27.250.155"
$SERVER_USER = "ubuntu"
$DEPLOY_DIR = "/opt/sora-ui-deploy"

Write-Host "ðŸ“¦ å‡†å¤‡æœåŠ¡å™¨çŽ¯å¢ƒ..." -ForegroundColor Yellow

ssh "${SERVER_USER}@${SERVER_IP}" @"
# åˆ›å»ºéƒ¨ç½²ç›®å½•
sudo mkdir -p ${DEPLOY_DIR}/{backend,nginx/conf.d,certbot/{conf,www},logs,updates,postgres-data}
sudo chown -R ubuntu:ubuntu ${DEPLOY_DIR}

# æ£€æŸ¥Docker
if ! command -v docker &> /dev/null; then
    echo 'â³ å®‰è£… Docker...'
    curl -fsSL https://get.docker.com | sh
    sudo systemctl start docker
    sudo systemctl enable docker
fi

# æ£€æŸ¥Docker Compose
if ! command -v docker-compose &> /dev/null; then
    echo 'â³ å®‰è£… Docker Compose...'
    sudo curl -L \"https://github.com/docker/compose/releases/latest/download/docker-compose-\$(uname -s)-\$(uname -m)\" -o /usr/local/bin/docker-compose
    sudo chmod +x /usr/local/bin/docker-compose
fi

echo 'âœ… æœåŠ¡å™¨çŽ¯å¢ƒå‡†å¤‡å®Œæˆ'
"@
```

---

## ðŸ“‹ å‘½ä»¤4: ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

**âš ï¸ è¿™ä¸ªå‘½ä»¤ä¼šéœ€è¦å‡ åˆ†é’Ÿæ—¶é—´**

```powershell
$SERVER_IP = "175.27.250.155"
$SERVER_USER = "ubuntu"
$DEPLOY_DIR = "/opt/sora-ui-deploy"

Write-Host "ðŸ“¤ ä¸Šä¼ é¡¹ç›®æ–‡ä»¶..." -ForegroundColor Yellow
Write-Host "â³ è¿™å¯èƒ½éœ€è¦5-10åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…..." -ForegroundColor Cyan

# åˆ›å»ºä¸´æ—¶ç›®å½•
$tempDir = New-Item -ItemType Directory -Path "$env:TEMP\sora-deploy-temp" -Force

# æŽ’é™¤æ¨¡å¼
$excludePatterns = @("node_modules", ".git", "dist", "build", ".env.local", "logs")

# å¤åˆ¶æ–‡ä»¶ï¼ˆæŽ’é™¤ä¸éœ€è¦çš„ï¼‰
Write-Host "ðŸ“‹ å‡†å¤‡æ–‡ä»¶..." -ForegroundColor Cyan
Get-ChildItem -Path "." -Recurse | Where-Object {
    $item = $_
    -not ($excludePatterns | Where-Object { $item.FullName -like "*$_*" })
} | ForEach-Object {
    $targetPath = $_.FullName.Replace($PWD.Path, $tempDir.FullName)
    $targetDir = Split-Path -Parent $targetPath
    if (-not (Test-Path $targetDir)) {
        New-Item -ItemType Directory -Path $targetDir -Force | Out-Null
    }
    if (-not $_.PSIsContainer) {
        Copy-Item $_.FullName $targetPath -Force
    }
}

# ä½¿ç”¨scpä¸Šä¼ 
Write-Host "ðŸ“¤ ä¸Šä¼ åˆ°æœåŠ¡å™¨..." -ForegroundColor Cyan
scp -r "$tempDir\*" "${SERVER_USER}@${SERVER_IP}:${DEPLOY_DIR}/backend/"

# æ¸…ç†ä¸´æ—¶ç›®å½•
Remove-Item -Recurse -Force $tempDir

Write-Host "âœ… é¡¹ç›®æ–‡ä»¶ä¸Šä¼ å®Œæˆ" -ForegroundColor Green
```

**ä¸Šä¼ è¿›åº¦è¯´æ˜Žï¼š**
- å¦‚æžœçœ‹åˆ°å¾ˆå¤šæ–‡ä»¶åæ»šåŠ¨ï¼Œè¯´æ˜Žæ­£åœ¨ä¸Šä¼ 
- è€å¿ƒç­‰å¾…ç›´åˆ°çœ‹åˆ° "âœ… é¡¹ç›®æ–‡ä»¶ä¸Šä¼ å®Œæˆ"

---

## ðŸ“‹ å‘½ä»¤5: é…ç½®Docker Compose

```powershell
$SERVER_IP = "175.27.250.155"
$SERVER_USER = "ubuntu"
$DEPLOY_DIR = "/opt/sora-ui-deploy"

Write-Host "âš™ï¸ é…ç½® Docker Compose..." -ForegroundColor Yellow

ssh "${SERVER_USER}@${SERVER_IP}" @'
cd /opt/sora-ui-deploy

# åˆ›å»º docker-compose.yml
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: sora-postgres
    restart: unless-stopped
    environment:
      - POSTGRES_USER=sorauser
      - POSTGRES_PASSWORD=sora_secure_pass_2024
      - POSTGRES_DB=sora_ui
      - TZ=Asia/Shanghai
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
    networks:
      - sora-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U sorauser -d sora_ui"]
      interval: 10s
      timeout: 5s
      retries: 5

  api:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: sora-api
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - PORT=3001
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_USER=sorauser
      - DB_PASSWORD=sora_secure_pass_2024
      - DB_NAME=sora_ui
      - JWT_SECRET=your-super-secure-jwt-secret-2024
      - LICENSE_SECRET=your-super-secure-license-key-2024
    volumes:
      - ./updates:/app/updates
      - ./logs:/app/logs
    networks:
      - sora-network
    depends_on:
      postgres:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3001/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx:
    image: nginx:alpine
    container_name: sora-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./certbot/conf:/etc/letsencrypt:ro
      - ./updates:/usr/share/nginx/html/updates:ro
    networks:
      - sora-network
    depends_on:
      - api

networks:
  sora-network:
    driver: bridge
EOF

# åˆ›å»º Nginx é…ç½®
cat > nginx/conf.d/default.conf << 'NGINX_EOF'
server {
    listen 80;
    server_name api.zuo2799662352.xyz update.zuo2799662352.xyz;
    
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }
    
    location / {
        proxy_pass http://api:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
NGINX_EOF

echo "âœ… é…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆ"
'@

Write-Host "âœ… Docker Compose é…ç½®å®Œæˆ" -ForegroundColor Green
```

---

## ðŸ“‹ å‘½ä»¤6: å¯åŠ¨æœåŠ¡

```powershell
$SERVER_IP = "175.27.250.155"
$SERVER_USER = "ubuntu"
$DEPLOY_DIR = "/opt/sora-ui-deploy"

Write-Host "ðŸš€ å¯åŠ¨æœåŠ¡..." -ForegroundColor Yellow

ssh "${SERVER_USER}@${SERVER_IP}" @"
cd ${DEPLOY_DIR}

echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
echo 'â³ å¯åŠ¨ PostgreSQL æ•°æ®åº“...'
docker-compose up -d postgres
sleep 10

echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
echo 'â³ æž„å»ºå¹¶å¯åŠ¨ Backend API (è¿™éœ€è¦å‡ åˆ†é’Ÿ)...'
docker-compose up -d --build api
sleep 15

echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
echo 'â³ å¯åŠ¨ Nginx åå‘ä»£ç†...'
docker-compose up -d nginx
sleep 5

echo ''
echo 'âœ… æ‰€æœ‰æœåŠ¡å·²å¯åŠ¨ï¼'
echo ''
echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
echo 'ðŸ“‹ æœåŠ¡çŠ¶æ€ï¼š'
docker-compose ps
"@

Write-Host "âœ… æœåŠ¡å¯åŠ¨å®Œæˆï¼" -ForegroundColor Green
```

---

## ðŸ“‹ å‘½ä»¤7: æµ‹è¯•éƒ¨ç½²

```powershell
Write-Host ""
Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
Write-Host "â•‘   ðŸ§ª æµ‹è¯•éƒ¨ç½²                         â•‘" -ForegroundColor Cyan
Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host ""

# æµ‹è¯•1: HTTPå¥åº·æ£€æŸ¥
Write-Host "[1/3] æµ‹è¯• HTTP å¥åº·æ£€æŸ¥..." -ForegroundColor Yellow
try {
    $response = Invoke-RestMethod -Uri "http://api.zuo2799662352.xyz/health" -Method Get
    Write-Host "âœ… HTTPè®¿é—®æˆåŠŸï¼" -ForegroundColor Green
    $response | ConvertTo-Json
} catch {
    Write-Host "âš ï¸ HTTPè®¿é—®å¤±è´¥: $($_.Exception.Message)" -ForegroundColor Yellow
}

Write-Host ""

# æµ‹è¯•2: HTTPSå¥åº·æ£€æŸ¥
Write-Host "[2/3] æµ‹è¯• HTTPS å¥åº·æ£€æŸ¥..." -ForegroundColor Yellow
try {
    $response = Invoke-RestMethod -Uri "https://api.zuo2799662352.xyz/health" -Method Get
    Write-Host "âœ… HTTPSè®¿é—®æˆåŠŸï¼" -ForegroundColor Green
    $response | ConvertTo-Json
} catch {
    Write-Host "âš ï¸ HTTPSè®¿é—®å¤±è´¥ï¼ˆå¦‚æžœè¿˜æœªé…ç½®SSLè¿™æ˜¯æ­£å¸¸çš„ï¼‰" -ForegroundColor Yellow
}

Write-Host ""

# æµ‹è¯•3: æœåŠ¡å™¨ç›´æŽ¥è®¿é—®
Write-Host "[3/3] æµ‹è¯•æœåŠ¡å™¨æœ¬åœ°è®¿é—®..." -ForegroundColor Yellow
ssh ubuntu@175.27.250.155 "curl -s http://localhost:3001/health"

Write-Host ""
Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Green
Write-Host "â•‘   ðŸŽ‰ éƒ¨ç½²æµ‹è¯•å®Œæˆï¼                   â•‘" -ForegroundColor Green
Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green
```

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

å®Œæˆä¸Šè¿°æ­¥éª¤åŽï¼Œæ‚¨åº”è¯¥ï¼š

- âœ… çœ‹åˆ° PostgreSQL å®¹å™¨è¿è¡Œä¸­
- âœ… çœ‹åˆ° API å®¹å™¨è¿è¡Œä¸­
- âœ… çœ‹åˆ° Nginx å®¹å™¨è¿è¡Œä¸­
- âœ… HTTPè®¿é—®æˆåŠŸè¿”å›žå¥åº·çŠ¶æ€
- âœ… ï¼ˆå¯é€‰ï¼‰HTTPSè®¿é—®æˆåŠŸï¼ˆå¦‚æžœå·²é…ç½®SSLï¼‰

---

## ðŸ“‹ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—
```powershell
ssh ubuntu@175.27.250.155 "cd /opt/sora-ui-deploy && docker-compose logs -f api"
```

### é‡å¯æœåŠ¡
```powershell
ssh ubuntu@175.27.250.155 "cd /opt/sora-ui-deploy && docker-compose restart api"
```

### æŸ¥çœ‹å®¹å™¨çŠ¶æ€
```powershell
ssh ubuntu@175.27.250.155 "cd /opt/sora-ui-deploy && docker-compose ps"
```

---

## ðŸ” ï¼ˆå¯é€‰ï¼‰é…ç½®SSLè¯ä¹¦

å¦‚æžœä¸€åˆ‡æ­£å¸¸ï¼Œå¯ä»¥ç»§ç»­é…ç½®SSLï¼š

```powershell
$SERVER_IP = "175.27.250.155"
$SERVER_USER = "ubuntu"

ssh "${SERVER_USER}@${SERVER_IP}" @'
cd /opt/sora-ui-deploy

# åœæ­¢Nginx
docker-compose stop nginx

# ç”³è¯·SSLè¯ä¹¦
docker run --rm \
  -v /opt/sora-ui-deploy/certbot/conf:/etc/letsencrypt \
  -v /opt/sora-ui-deploy/certbot/www:/var/www/certbot \
  -p 80:80 \
  certbot/certbot certonly \
  --standalone \
  --non-interactive \
  --email zuozuoliang999@gmail.com \
  --agree-tos \
  --no-eff-email \
  -d api.zuo2799662352.xyz \
  -d update.zuo2799662352.xyz

if [ $? -eq 0 ]; then
    echo "âœ… SSLè¯ä¹¦ç”³è¯·æˆåŠŸ"
    # æ›´æ–°Nginxé…ç½®ä¸ºHTTPSï¼ˆå‚è€ƒSSL.MDï¼‰
    docker-compose up -d nginx
else
    echo "âŒ SSLè¯ä¹¦ç”³è¯·å¤±è´¥"
    docker-compose up -d nginx
fi
'@
```

---

## ðŸŽ¯ å®Œæˆï¼

**æ‚¨çš„ç”Ÿäº§çŽ¯å¢ƒå·²éƒ¨ç½²å®Œæˆï¼**

è®¿é—®åœ°å€ï¼š
- **HTTP**: http://api.zuo2799662352.xyz
- **HTTPS**: https://api.zuo2799662352.xyz ï¼ˆé…ç½®SSLåŽï¼‰

---

**é‡åˆ°é—®é¢˜ï¼Ÿ**
- æŸ¥çœ‹ `å¿«é€Ÿå¼€å§‹.md` çš„æ•…éšœæŽ’æŸ¥éƒ¨åˆ†
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—å®šä½é—®é¢˜
- æ£€æŸ¥å®‰å…¨ç»„å’Œé˜²ç«å¢™é…ç½®

