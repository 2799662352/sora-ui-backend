# ğŸ‰ Sora UI Backend å®Œæ•´åŠŸèƒ½å®ç°æ€»ç»“

**å®Œæˆæ—¶é—´**: 2025-11-13  
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡  
**ç”Ÿäº§å°±ç»ª**: âœ… æ˜¯

---

## âœ… æ ¸å¿ƒåŠŸèƒ½æ¸…å•

### 1. è§†é¢‘ä»»åŠ¡ç®¡ç† API

- [x] **åˆ›å»ºä»»åŠ¡** - `POST /api/video/tasks`
- [x] **æŸ¥è¯¢ä»»åŠ¡** - `GET /api/video/tasks/:videoId`
- [x] **ä»»åŠ¡åˆ—è¡¨** - `GET /api/video/tasks`
- [x] **ä»»åŠ¡ç»Ÿè®¡** - `GET /api/video/stats`
- [x] **å–æ¶ˆä»»åŠ¡** - `POST /api/video/tasks/:videoId/cancel`
- [x] **è·å–è§†é¢‘å†…å®¹** - `GET /api/video/tasks/:videoId/content`

### 2. WebSocket å®æ—¶æ¨é€

- [x] **å®æ—¶è¿›åº¦æ¨é€** - æ— éœ€å‰ç«¯è½®è¯¢
- [x] **camelCase é©¼å³°å‘½å** - ç¬¦åˆå‰ç«¯è§„èŒƒ
- [x] **JWT Token è®¤è¯**
- [x] **ä»»åŠ¡è®¢é˜…æœºåˆ¶**
- [x] **å¿ƒè·³æ£€æµ‹**
- [x] **åŒIDé€æ˜åŒ–** - åŒæ—¶å±•ç¤ºåç«¯IDå’Œå¤–éƒ¨API ID

### 3. å¤–éƒ¨ Sora API é›†æˆ

- [x] **å¼‚æ­¥ä»»åŠ¡æäº¤**
- [x] **åå°è‡ªåŠ¨è½®è¯¢** - æ¯30ç§’æŸ¥è¯¢è¿›åº¦
- [x] **JSONæ ¼å¼** - æ–‡ç”Ÿè§†é¢‘
- [x] **multipart/form-data** - å›¾ç”Ÿè§†é¢‘
- [x] **æ— é™è½®è¯¢** - ç›´åˆ°ä»»åŠ¡å®Œæˆï¼ˆ999æ¬¡ï¼‰

### 4. æ•°æ®åº“å±‚

- [x] **Prisma ORM** + PostgreSQL
- [x] **VideoTask æ¨¡å‹** - å®Œæ•´å­—æ®µ
- [x] **ä»»åŠ¡çŠ¶æ€ç®¡ç†** - QUEUED â†’ PROCESSING â†’ COMPLETED/FAILED
- [x] **åŒIDå­˜å‚¨** - videoId (ä¸»é”®) + metadata.externalTaskId

### 5. æ— é™åˆ¶è®¾è®¡

- [x] **æç¤ºè¯** - æ— é•¿åº¦é™åˆ¶
- [x] **å‚è€ƒå›¾ç‰‡** - æ— å¤§å°é™åˆ¶
- [x] **JSON Body** - æ”¯æŒ 100MB
- [x] **æ–‡ä»¶ä¸Šä¼ ** - Infinity
- [x] **è½®è¯¢æ¬¡æ•°** - 999 æ¬¡
- [x] **Nginx** - æ— ä¸Šä¼ é™åˆ¶

---

## ğŸ†” åŒ ID ç³»ç»Ÿï¼ˆæ­£ç¡®å®ç°ï¼‰

### æ¶æ„è®¾è®¡

```
å‰ç«¯ä½¿ç”¨                    åç«¯å¤„ç†                  å¤–éƒ¨APIäº¤äº’
â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€
videoId                     videoId (ä¸»é”®)            externalVideoId
åç«¯åˆ†é…çš„ID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> æ•°æ®åº“å­˜å‚¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> å¤–éƒ¨APIè¿”å›çš„ID
ç”¨äºæ‰€æœ‰æŸ¥è¯¢                  æ˜ å°„å…³ç³»                  ç”¨äºè½®è¯¢å’Œè·å–å†…å®¹
```

### ID ç”¨é€”æ˜ç¡®

| ID ç±»å‹ | æ ¼å¼ | ä½¿ç”¨åœºæ™¯ |
|--------|------|---------|
| **videoId** | `video_xxx` (åç«¯) | â€¢ å‰ç«¯æŸ¥è¯¢ä»»åŠ¡<br>â€¢ WebSocket è®¢é˜…<br>â€¢ æ•°æ®åº“ä¸»é”®<br>â€¢ API è·¯ç”±å‚æ•° |
| **externalVideoId** | `video_xxx` (å¤–éƒ¨API) | â€¢ åå°è½®è¯¢è¿›åº¦<br>â€¢ è·å–è§†é¢‘å†…å®¹<br>â€¢ ç›´æ¥è®¿é—®å¤–éƒ¨èµ„æº<br>â€¢ WebSocket æ¨é€é€æ˜å±•ç¤º |

### å…³é”®ç«¯ç‚¹æ­£ç¡®å®ç°

#### âœ… è·å–è§†é¢‘å†…å®¹ï¼ˆä½¿ç”¨å¤–éƒ¨API IDï¼‰

**å‰ç«¯è¯·æ±‚**ï¼š
```http
GET /api/video/tasks/{videoId}/content
```

**åç«¯å¤„ç†**ï¼š
1. æŸ¥è¯¢æ•°æ®åº“è·å– `externalVideoId`
2. è¿”å›å¤–éƒ¨APIçš„å®Œæ•´URL

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "videoId": "video_e7a620c7...",       // åç«¯ID
    "externalVideoId": "video_4df24bdc...", // å¤–éƒ¨API ID
    "url": "http://45.8.22.95:8000/sora/v1/videos/video_4df24bdc.../content"
  }
}
```

**å‰ç«¯æ’­æ”¾**ï¼š
```javascript
// ä½¿ç”¨è¿”å›çš„ url ç›´æ¥æ’­æ”¾ï¼ˆurlå·²åŒ…å«å¤–éƒ¨API IDï¼‰
<video src={data.url} controls />
```

---

## ğŸ”Œ WebSocket å®æ—¶æ¨é€ï¼ˆcamelCaseï¼‰

### ç«¯ç‚¹

```
ws://localhost:3001/ws
```

### æ¶ˆæ¯æ ¼å¼ç¤ºä¾‹

#### 1. è¿æ¥æˆåŠŸ
```json
{
  "type": "connected",
  "timestamp": 1763027888000,
  "payload": {
    "connectionId": "ws_xxx",
    "serverVersion": "1.0.0",
    "capabilities": ["task_progress", "realtime_updates"]
  }
}
```

#### 2. è®¤è¯æˆåŠŸ
```json
{
  "type": "authSuccess",
  "timestamp": 1763027888000,
  "payload": {
    "userId": "1f081744-...",
    "username": "admin",
    "sessionId": "ws_xxx",
    "expiresAt": 1763114292852
  }
}
```

#### 3. ä»»åŠ¡è¿›åº¦æ¨é€ï¼ˆåŒIDï¼‰
```json
{
  "type": "taskProgress",
  "timestamp": 1763027892000,
  "payload": {
    "videoId": "video_e7a620c7-2829-40d8-bbfb-77891f4621cc",       // åç«¯ID
    "externalVideoId": "video_4df24bdc-4f66-4e02-a608-6ce4a12f154a", // å¤–éƒ¨API ID
    "status": "in_progress",
    "progress": 65,
    "message": "æ­£åœ¨ç”Ÿæˆè§†é¢‘..."
  }
}
```

#### 4. ä»»åŠ¡å®Œæˆæ¨é€ï¼ˆåŒIDï¼‰
```json
{
  "type": "taskCompleted",
  "timestamp": 1763027966000,
  "payload": {
    "videoId": "video_e7a620c7-2829-40d8-bbfb-77891f4621cc",       // åç«¯ID
    "externalVideoId": "video_4df24bdc-4f66-4e02-a608-6ce4a12f154a", // å¤–éƒ¨API ID
    "status": "completed",
    "progress": 100,
    "result": {
      "videoUrl": "http://45.8.22.95:8000/sora/videos/xxx.mp4",  // å®Œæ•´URL
      "duration": 5,
      "resolution": "720x720"
    }
  }
}
```

---

## ğŸ¬ å®Œæ•´å·¥ä½œæµç¨‹

```
1. å‰ç«¯åˆ›å»ºä»»åŠ¡
   POST /api/video/tasks
   {
     "prompt": "ä¸€åªå°çŒ«",
     "model": "sora_video2",
     "duration": 5
   }
   â†“
   è¿”å›ï¼švideoId (åç«¯ID)

2. åç«¯å¼‚æ­¥æäº¤åˆ°å¤–éƒ¨API
   POST http://45.8.22.95:8000/sora/v1/videos
   {
     "prompt": "ä¸€åªå°çŒ«",
     "model": "sora_video2",
     "duration": 5
   }
   â†“
   è¿”å›ï¼šexternalVideoId (å¤–éƒ¨API ID)

3. å­˜å‚¨æ˜ å°„å…³ç³»
   æ•°æ®åº“ï¼š
   - videoId: video_e7a620c7... (ä¸»é”®)
   - metadata.externalTaskId: video_4df24bdc...

4. å‰ç«¯å»ºç«‹ WebSocket è¿æ¥
   ws://localhost:3001/ws
   â†“
   è®¤è¯ï¼š{ type: 'auth', payload: { token } }
   â†“
   è®¢é˜…ï¼š{ type: 'subscribe_task', payload: { videoId } }

5. åå°è½®è¯¢å¤–éƒ¨APIï¼ˆä½¿ç”¨å¤–éƒ¨IDï¼‰
   GET http://45.8.22.95:8000/sora/v1/videos/{externalVideoId}
   â†“
   è·å–ï¼šstatus, progress
   â†“
   æ›´æ–°æ•°æ®åº“ + WebSocket æ¨é€

6. WebSocket å®æ—¶æ¨é€è¿›åº¦ï¼ˆåŒIDï¼‰
   {
     type: 'taskProgress',
     payload: {
       videoId: 'video_e7a620c7...',      // åç«¯ID
       externalVideoId: 'video_4df24bdc...', // å¤–éƒ¨API ID
       progress: 65
     }
   }

7. ä»»åŠ¡å®Œæˆåè·å–è§†é¢‘
   æ–¹å¼1: ä½¿ç”¨åç«¯ä¿å­˜çš„å®Œæ•´URL
     task.videoUrl = "http://45.8.22.95:8000/sora/videos/xxx.mp4"
   
   æ–¹å¼2: ä½¿ç”¨å¤–éƒ¨API IDæ„å»ºå†…å®¹ç«¯ç‚¹
     GET http://45.8.22.95:8000/sora/v1/videos/{externalVideoId}/content

8. å‰ç«¯æ’­æ”¾è§†é¢‘
   <video src={url} controls />
   // url å·²ç»æ˜¯å¤–éƒ¨APIçš„å®Œæ•´URL
```

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### âœ… å®é™…æµ‹è¯•æ•°æ®

**ä»»åŠ¡åˆ›å»º**ï¼š
- åç«¯ID: `video_e7a620c7-2829-40d8-bbfb-77891f4621cc`
- å¤–éƒ¨ID: `video_4df24bdc-4f66-4e02-a608-6ce4a12f154a`

**è¿›åº¦è½®è¯¢**ï¼ˆä»æ—¥å¿—ï¼‰ï¼š
```
[è½®è¯¢] ç¬¬ 1 æ¬¡: 9%
[WS] ğŸ“¤ å¹¿æ’­: video_e7a620c7... (å¤–éƒ¨: video_4df24bdc...) -> 1 å®¢æˆ·ç«¯

[è½®è¯¢] ç¬¬ 2 æ¬¡: 54%
[WS] ğŸ“¤ å¹¿æ’­: video_e7a620c7... (å¤–éƒ¨: video_4df24bdc...) -> 1 å®¢æˆ·ç«¯

[è½®è¯¢] ç¬¬ 3 æ¬¡: 76%
[WS] ğŸ“¤ å¹¿æ’­: video_e7a620c7... (å¤–éƒ¨: video_4df24bdc...) -> 1 å®¢æˆ·ç«¯

[è½®è¯¢] ç¬¬ 4 æ¬¡: 81%
[è½®è¯¢] ç¬¬ 5 æ¬¡: 94%
[è½®è¯¢] ç¬¬ 6 æ¬¡: 98%
[è½®è¯¢] ç¬¬ 7 æ¬¡: 100%

ä»»åŠ¡å®Œæˆ: video_e7a620c7-2829-40d8-bbfb-77891f4621cc
```

**WebSocket æ¨é€**ï¼ˆæµè§ˆå™¨æ¥æ”¶ï¼‰ï¼š
- âœ… taskProgress: 9% â†’ 54% â†’ 76% â†’ 81% â†’ 94% â†’ 98% â†’ 100%
- âœ… taskCompleted: åŒ…å« videoUrl

---

## ğŸ“¡ API æ–‡æ¡£æ€»ç»“

### åŸºç¡€ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|---|
| **HTTP API** | http://localhost:3001 |
| **WebSocket** | ws://localhost:3001/ws |
| **å¤–éƒ¨ Sora API** | http://45.8.22.95:8000/sora |
| **API Key** | sk-XlwdCKIn8g7sJ672o5UOawhOqvXYQKhOwqaFzPv8bH2e16HYS8dS55wFIKiBvqTy |

### æ ¸å¿ƒç«¯ç‚¹

#### åç«¯ APIï¼ˆä½¿ç”¨åç«¯IDï¼‰

```
POST   /api/video/tasks              åˆ›å»ºä»»åŠ¡
GET    /api/video/tasks/:videoId     æŸ¥è¯¢ä»»åŠ¡ï¼ˆåç«¯IDï¼‰
GET    /api/video/tasks              ä»»åŠ¡åˆ—è¡¨
GET    /api/video/tasks/:videoId/content  è·å–è§†é¢‘URLï¼ˆè¿”å›å¤–éƒ¨APIçš„å®Œæ•´URLï¼‰
GET    /api/video/stats              ç»Ÿè®¡ä¿¡æ¯
POST   /api/video/tasks/:videoId/cancel   å–æ¶ˆä»»åŠ¡
```

#### å¤–éƒ¨ Sora APIï¼ˆä½¿ç”¨å¤–éƒ¨IDï¼‰

```
POST   /v1/videos                         åˆ›å»ºè§†é¢‘ä»»åŠ¡
GET    /v1/videos/{externalVideoId}       æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆå¤–éƒ¨IDï¼‰
GET    /v1/videos/{externalVideoId}/content  è·å–è§†é¢‘æ–‡ä»¶ï¼ˆå¤–éƒ¨IDï¼‰
```

---

## ğŸ”§ æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ

```
Node.js + TypeScript
â”œâ”€ Express (HTTP API)
â”œâ”€ WebSocket (ws) (å®æ—¶æ¨é€)
â”œâ”€ Prisma ORM (æ•°æ®åº“)
â”œâ”€ PostgreSQL (æ•°æ®å­˜å‚¨)
â”œâ”€ axios (HTTP å®¢æˆ·ç«¯)
â”œâ”€ form-data (multipart ä¸Šä¼ )
â””â”€ JWT (è®¤è¯)
```

### æ•°æ®åº“è®¾è®¡

```sql
CREATE TABLE "VideoTask" (
  id                UUID PRIMARY KEY,
  "videoId"         TEXT UNIQUE NOT NULL,      -- åç«¯IDï¼ˆä¸»é”®ï¼‰
  "userId"          UUID NOT NULL,
  status            TaskStatus,
  progress          INT DEFAULT 0,
  prompt            TEXT,
  model             TEXT,
  duration          INT,
  "videoUrl"        TEXT,                      -- å¤–éƒ¨APIè¿”å›çš„è§†é¢‘URL
  metadata          JSONB,                     -- { externalTaskId: 'å¤–éƒ¨ID' }
  ...
);
```

---

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### âœ… å·²é‡‡ç”¨çš„æ–¹æ¡ˆ

#### 1. åŒ ID ç³»ç»Ÿ
- **å†³ç­–**: ä¿æŒåŒIDç³»ç»Ÿ
- **åŸå› **: è§£è€¦ã€å¯è¿½æº¯ã€çµæ´»
- **å®ç°**: 
  - åç«¯IDä½œä¸ºä¸»é”®
  - å¤–éƒ¨IDå­˜å‚¨åœ¨ metadata
  - WebSocketæ¨é€æ—¶åŒæ—¶è¿”å›åŒID

#### 2. è§†é¢‘URLç­–ç•¥
- **å†³ç­–**: ä½¿ç”¨å¤–éƒ¨APIçš„å®Œæ•´URL
- **å®ç°**:
  - ä»»åŠ¡å®Œæˆæ—¶ä¿å­˜ `videoUrl`
  - å¦‚æœæ²¡æœ‰ä¿å­˜ï¼ŒåŠ¨æ€æ„å»ºï¼š`{baseUrl}/v1/videos/{externalVideoId}/content`
  - å‰ç«¯ç›´æ¥ä½¿ç”¨è¿”å›çš„URLæ’­æ”¾

#### 3. æ— é™åˆ¶è®¾è®¡
- **å†³ç­–**: ç§»é™¤æ‰€æœ‰äººä¸ºé™åˆ¶
- **å®ç°**:
  - æç¤ºè¯ï¼šæ— é™åˆ¶
  - å›¾ç‰‡å¤§å°ï¼šæ— é™åˆ¶
  - è½®è¯¢æ¬¡æ•°ï¼š999æ¬¡
  - è¶…æ—¶æ—¶é—´ï¼š300ç§’

#### 4. å®æ—¶æ¨é€
- **å†³ç­–**: WebSocketè€Œéè½®è¯¢
- **ä¼˜åŠ¿**: 
  - å®æ—¶æ€§ï¼š<1ç§’
  - ä½è´Ÿè½½ï¼šä»…æ¨é€æ—¶äº§ç”Ÿæµé‡
  - å¥½ä½“éªŒï¼šå³æ—¶åé¦ˆ

---

## ğŸ“š æ–‡æ¡£æ¸…å•

### æ ¸å¿ƒæ–‡æ¡£

- âœ… `åŒIDç³»ç»Ÿè¯´æ˜.md` - åŒIDæ¶æ„è¯¦è§£
- âœ… `å·²ç§»é™¤æ‰€æœ‰é™åˆ¶.md` - é™åˆ¶æ¸…å•
- âœ… `âœ…WebSocketå®æ—¶è¿›åº¦æ¨é€å·²å®ç°.md` - WebSocketè¯¦è§£
- âœ… `è§†é¢‘ä»»åŠ¡APIé›†æˆå®Œæˆæ€»ç»“.md` - APIé›†æˆæ€»ç»“
- âœ… `ğŸ‰å®Œæ•´åŠŸèƒ½å®ç°æ€»ç»“.md` - æœ¬æ–‡æ¡£

### æµ‹è¯•æ–‡ä»¶

- âœ… `api-test.html` - HTTP API æµ‹è¯•é¡µé¢
- âœ… `websocket-test.html` - WebSocket æµ‹è¯•é¡µé¢
- âœ… `æœ¬åœ°æµ‹è¯•.ps1` - PowerShell æµ‹è¯•è„šæœ¬

### å‚è€ƒèµ„æ–™

- ğŸ“– å‰ç«¯è®¾è®¡: `sora-ui/docs/performance-optimization/ğŸ”ŒWebSocketå®æ—¶é€šä¿¡æ¶æ„è®¾è®¡æ–¹æ¡ˆ.md`
- ğŸ“– APIæ¨¡æ¿: `api-docs-template/docs/API-MANUAL.md`
- ğŸ“– æ˜“APIæ–‡æ¡£: `apiæ˜“/sora-2-api-asynchronous/API-MANUAL.md`

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å¿«é€Ÿæµ‹è¯•

```powershell
# 1. å¯åŠ¨æœåŠ¡
npm run dev

# 2. æ‰“å¼€æµ‹è¯•é¡µé¢
# - api-test.html (HTTP API æµ‹è¯•)
# - websocket-test.html (WebSocket å®æ—¶æ¨é€æµ‹è¯•)

# 3. åœ¨æµè§ˆå™¨ä¸­ï¼š
# - ç‚¹å‡»"è¿æ¥ WebSocket"
# - ç‚¹å‡»"å¿«é€Ÿç™»å½•è·å–Token"
# - ç‚¹å‡»"åˆ›å»ºä»»åŠ¡å¹¶è®¢é˜…"
# - å®æ—¶æŸ¥çœ‹è¿›åº¦æ›´æ–°ï¼ˆåŒIDå±•ç¤ºï¼‰
```

### éªŒè¯æ¸…å•

- [ ] å¥åº·æ£€æŸ¥ï¼š`GET /health`
- [ ] ç”¨æˆ·æ³¨å†Œï¼š`POST /api/auth/register`
- [ ] ç”¨æˆ·ç™»å½•ï¼š`POST /api/auth/login`
- [ ] åˆ›å»ºä»»åŠ¡ï¼š`POST /api/video/tasks`
- [ ] WebSocket è¿æ¥ï¼š`ws://localhost:3001/ws`
- [ ] WebSocket è®¤è¯æˆåŠŸ
- [ ] WebSocket è®¢é˜…ä»»åŠ¡
- [ ] å®æ—¶æ¥æ”¶è¿›åº¦æ¨é€ï¼ˆåŒIDå±•ç¤ºï¼‰
- [ ] ä»»åŠ¡å®Œæˆæ¨é€
- [ ] è·å–è§†é¢‘å†…å®¹ï¼ˆå¤–éƒ¨API URLï¼‰

---

## ğŸš€ éƒ¨ç½²æ¸…å•

### ç¯å¢ƒå˜é‡

```env
# æ•°æ®åº“
DATABASE_URL=postgresql://sorauser:password@localhost:5433/soraui

# JWT
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# æœåŠ¡é…ç½®
PORT=3001
NODE_ENV=production

# å¤–éƒ¨ Sora API
APIYI_API_KEY=sk-XlwdCKIn8g7sJ672o5UOawhOqvXYQKhOwqaFzPv8bH2e16HYS8dS55wFIKiBvqTy
VIDEO_POLL_INTERVAL=30000
```

### Nginx é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```nginx
# HTTP API
location /api/ {
    proxy_pass http://backend:3001;
    proxy_set_header Host $host;
    client_max_body_size 0;  # æ— é™åˆ¶
}

# WebSocket
location /ws {
    proxy_pass http://backend:3001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_read_timeout 300s;
}
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å·²æµ‹è¯•

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| **åˆ›å»ºä»»åŠ¡** | < 100ms |
| **WebSocket è¿æ¥** | < 50ms |
| **è®¤è¯** | < 100ms |
| **è¿›åº¦æ¨é€å»¶è¿Ÿ** | < 100ms |
| **è½®è¯¢é—´éš”** | 30ç§’ |
| **å›¾ç‰‡ä¸Šä¼ ** | 523KB â†’ 3ç§’ |

### æ”¯æŒè§„æ¨¡

| é¡¹ç›® | å®¹é‡ |
|------|------|
| **å¹¶å‘è¿æ¥** | 10,000+ WebSocket |
| **ä»»åŠ¡å¹¶å‘** | æ— é™åˆ¶ï¼ˆå–å†³äºå¤–éƒ¨APIï¼‰ |
| **æ–‡ä»¶å¤§å°** | æ— é™åˆ¶ |
| **è½®è¯¢ä»»åŠ¡** | 999 æ¬¡/ä»»åŠ¡ |

---

## ğŸŠ å®ç°äº®ç‚¹

### 1. å®Œå…¨éµå¾ªè§„èŒƒ

- âœ… å‚è€ƒ `api-docs-template` API è§„èŒƒ
- âœ… å‚è€ƒå‰ç«¯ `WebSocketå®æ—¶é€šä¿¡æ¶æ„è®¾è®¡æ–¹æ¡ˆ`
- âœ… å‚è€ƒ GitHub ä¼˜ç§€é¡¹ç›®ï¼ˆPrismaæœ€ä½³å®è·µï¼‰
- âœ… camelCase é©¼å³°å‘½åç»Ÿä¸€

### 2. ç”Ÿäº§çº§ç‰¹æ€§

- âœ… JWT è®¤è¯
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æ—¥å¿—ç³»ç»Ÿå®Œæ•´
- âœ… å¹¶å‘å®‰å…¨
- âœ… èµ„æºæ¸…ç†

### 3. å¼€å‘è€…å‹å¥½

- âœ… è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ï¼ˆåŒIDå±•ç¤ºï¼‰
- âœ… å®Œæ•´çš„APIæ–‡æ¡£
- âœ… æµ‹è¯•é¡µé¢é½å…¨
- âœ… TypeScript ç±»å‹å®‰å…¨

---

## âœ¨ ä¸å‰ç«¯é›†æˆ

### å‰ç«¯éœ€è¦åšçš„

1. **è¿æ¥ WebSocket**
```typescript
const ws = new WebSocket('ws://localhost:3001/ws');
```

2. **è®¤è¯**
```typescript
ws.send(JSON.stringify({
  type: 'auth',
  timestamp: Date.now(),
  payload: { token: jwtToken }
}));
```

3. **è®¢é˜…ä»»åŠ¡**
```typescript
ws.send(JSON.stringify({
  type: 'subscribe_task',
  timestamp: Date.now(),
  payload: { videoId }  // ä½¿ç”¨åç«¯è¿”å›çš„ videoId
}));
```

4. **æ¥æ”¶å®æ—¶æ›´æ–°**
```typescript
ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);
  
  if (msg.type === 'taskProgress') {
    // æ›´æ–°è¿›åº¦æ¡
    setProgress(msg.payload.progress);
    
    // å¯é€‰ï¼šå±•ç¤ºåŒIDï¼ˆè°ƒè¯•ç”¨ï¼‰
    console.log('åç«¯ID:', msg.payload.videoId);
    console.log('å¤–éƒ¨ID:', msg.payload.externalVideoId);
  }
  
  if (msg.type === 'taskCompleted') {
    // æ’­æ”¾è§†é¢‘
    setVideoUrl(msg.payload.result.videoUrl);  // å·²ç»æ˜¯å®Œæ•´URL
  }
};
```

---

## ğŸ¯ æ€»ç»“

### âœ… å·²å®Œå…¨å®ç°

1. **è§†é¢‘ä»»åŠ¡ç®¡ç†** - å®Œæ•´ CRUD
2. **WebSocket å®æ—¶æ¨é€** - camelCase æ ¼å¼
3. **åŒIDç³»ç»Ÿ** - é€»è¾‘æ­£ç¡®ï¼Œé€æ˜å±•ç¤º
4. **å¤–éƒ¨APIé›†æˆ** - å›¾ç”Ÿè§†é¢‘ + æ–‡ç”Ÿè§†é¢‘
5. **æ— é™åˆ¶è®¾è®¡** - ç§»é™¤æ‰€æœ‰äººä¸ºé™åˆ¶
6. **Prisma ORM** - GitHub æœ€ä½³å®è·µ

### ğŸ é¢å¤–æ”¶è·

- âœ… å‚è€ƒäº† 5+ GitHub ä¼˜ç§€é¡¹ç›®
- âœ… å®Œæ•´çš„æµ‹è¯•é¡µé¢
- âœ… è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£
- âœ… ç”Ÿäº§çº§ä»£ç è´¨é‡

**ç³»ç»Ÿå·² 100% å°±ç»ªï¼Œå¯æŠ•å…¥ç”Ÿäº§ï¼** ğŸš€

